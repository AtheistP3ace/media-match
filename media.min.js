/* Media - Testing css media queries in Javascript. Authors & copyright (c) 2012: WebLinc, David Knight, Zac Owen. */

(function(c){var l=c.document,p=l.getElementsByTagName("head")[0],d=c.getComputedStyle&&c.getComputedStyle(p,null)||p.currentStyle,q=l.documentElement,t=/\(\s*(not)?\s*(min|max)?-?([^:\s]+)\s*:\s*([^\s]+)\s*\)/,u=/(not)?\s*(\w*)/,n=0,r=0;c.Media={supported:!1,type:"all",queries:[],features:{width:0,height:0,"aspect-ratio":0,color:screen.colorDepth,"color-index":Math.pow(2,screen.colorDepth),"device-aspect-ratio":0,"device-width":screen.width,"device-height":screen.height,monochrome:Number(2==screen.colorDepth),
orientation:"landscape",resolution:96},getAbsValue:function(b){var a;return(a=b.match(/([\d\.]+)(px|em|rem|%|in|cm|mm|ex|pt|pc)/))?"em"==a[2]?16*a[1]:"pt"==a[2]?this.features.resolution/72*a[1]:1*a[1]:(a=b.match(/(\d+)[\/:](\d+)/))?a[1]/a[2]:(a=b.match(/([\d]+)(dpi|dppx|dpcm)/))?"dpcm"==a[2]?0.3937*a[1]:"dppx"==a[2]?96*a[1]:1*a[1]:b},parseMatch:function(b,a){var e="string"===typeof b?b.split(", "):b,s=e.pop(),c="all",k=s.split(" and "),m=k.length-1;do{var f=null,g=!0,h=null,h=!0,j=!1;if(-1===k[m].indexOf("(")||
(f=k[m].match(t))){if(f)var g=this.features[f[3]],d=this.getAbsValue(f[4]),j="not"===f[1],g="min"===f[2]?g>=d:"max"===f[2]?g<=d:"undefined"!==f[4]?g===d:g;else h=k[m].match(u)||["",""],j="not"===h[1],c=h[2]||c,h=c===this.type||"all"===c,a&&j&&(c="screen, print, speech, projection, handheld, tv, braille, embossed, tty".split(c).join(", ").replace(/(,\s){2}/,""));if(f&&(j&&g||!j&&!g)||!f&&(j&&h||!j&&!h))return e.length?this.parseMatch(e,a):!1}}while(m--);return a&&{matches:!0,type:c,media:s}||!0},match:function(b){var a=
n;b={matches:Media.parseMatch(b,!1),media:b,addListener:function(b){Media.queries[a].listeners||(Media.queries[a].listeners=[]);b&&Media.queries[a].listeners.push(b)},removeListener:function(b){var c=Media.queries[a];if(c)for(var d=0,k=c.listeners.length;d<k;d++)c.listeners[d]===b&&c.listeners.splice(d,1)}};n++;Media.queries.push({mql:b,listeners:null});return b},watch:function(b){clearTimeout(r);r=setTimeout(function(){var a=n;Media.setMutableFeatures();do{var e=Media.queries[a],d=!1;if("undefined"!==
typeof e&&((d=Media.parseMatch(e.mql.media))&&!e.mql.matches||!d&&e.mql.matches))if(e.mql.matches=d,e.listeners)for(var d=0,l=e.listeners.length;d<l;d++)e.listeners[d]&&e.listeners[d].call(c,e.mql,b)}while(a--)},10)},setMutableFeatures:function(){var b=c.innerWidth||q.clientWidth,a=c.innerHeight||q.clientHeight;this.features.width=b;this.features.height=a;this.features["aspect-ratio"]=(a>=b?a/b:b/a).toFixed(2);this.features.orientation=a>=b?"portrait":"landscape"},listen:function(b){c.addEventListener?
(c.addEventListener("resize",b),c.addEventListener("orientationchange",b)):c.attachEvent&&(c.attachEvent("onresize",b),c.attachEvent("onorientationchange",b))},init:function(){var b=screen.width,a=screen.height,e=c.devicePixelRatio;this.supported=1===parseFloat(d.height);this.type="screen print speech projection handheld tv braille embossed tty".split(" ")[parseFloat(d.zIndex)-1]||"all";this.features["device-aspect-ratio"]=(a>=b?a/b:b/a).toFixed(2);this.features.resolution=e&&96*e||screen.deviceXDPI||
parseFloat(d.width);this.setMutableFeatures();this.listen(this.watch)}};Media.init()})(window);