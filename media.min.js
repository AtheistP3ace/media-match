/* Media - Testing css media queries in Javascript. Authors & copyright (c) 2012: WebLinc, David Knight, Zac Owen. */

(function(c){var j=c.document,d=j.getElementsByTagName("head")[0],n=c.getComputedStyle&&c.getComputedStyle(d,null)||d.currentStyle,d=screen.width,q=screen.height,r=screen.colorDepth,s=j.documentElement,u=/\(\s*(not)?\s*(min|max)?-?([^:\s]+)\s*:\s*([^\s]+)\s*\)/,v=/(not)?\s*(\w*)/,p=0,t=0;c.Media={supported:!1,type:"all",queries:[],features:{width:0,height:0,"aspect-ratio":0,color:r,"color-index":Math.pow(2,r),"device-aspect-ratio":(q/d).toFixed(2),"device-width":d,"device-height":q,orientation:"landscape",
resolution:96,"touch-enabled":Number("ontouchstart"in c||c.DocumentTouch&&j instanceof DocumentTouch)},getAbsValue:function(a){var b;return(b=a.match(/([\d\.]+)(px|em|rem|%|in|cm|mm|ex|pt|pc)/))?"em"==b[2]?16*b[1]:"pt"==b[2]?this.features.resolution/72*b[1]:1*b[1]:(b=a.match(/(\d+)[\/:](\d+)/))?b[1]/b[2]:(b=a.match(/([\d]+)(dpi|dppx|dpcm)/))?"dpcm"==b[2]?0.3937*b[1]:"dppx"==b[2]?96*b[1]:1*b[1]:a},parseMatch:function(a,b){var e="string"===typeof a?a.split(", "):a,c=e.pop(),f="all",m=c.split(" and "),
d=m.length-1;do{var g=null,h=!0,k=null,k=!0,l=!1;if(-1===m[d].indexOf("(")||(g=m[d].match(u))){if(g)var h=this.features[g[3]],j=this.getAbsValue(g[4]),l="not"===g[1],h="min"===g[2]?h>=j:"max"===g[2]?h<=j:"undefined"!==g[4]?h===j:h;else k=m[d].match(v)||["",""],l="not"===k[1],f=k[2]||f,k=f===this.type||"all"===f,b&&l&&(f="screen, print, speech, projection, handheld, tv, braille, embossed, tty".split(f).join(", ").replace(/(,\s){2}/,""));if(g&&(l&&h||!l&&!h)||!g&&(l&&k||!l&&!k))return e.length?this.parseMatch(e,
b):!1}}while(d--);return b&&{matches:!0,type:f,media:c}||!0},match:function(a){var b=p;a={matches:Media.parseMatch(a,!1),media:a,addListener:function(a){Media.queries[b].listeners||(Media.queries[b].listeners=[]);a&&Media.queries[b].listeners.push(a)},removeListener:function(a){var c=Media.queries[b];if(c)for(var f=0,d=c.listeners.length;f<d;f++)c.listeners[f]===a&&c.listeners.splice(f,1)}};p++;Media.queries.push({mql:a,listeners:null});return a},watch:function(a){clearTimeout(t);t=setTimeout(function(){var b=
p;Media.setMutableFeatures();do{var e=Media.queries[b],d=!1;if("undefined"!==typeof e&&((d=Media.parseMatch(e.mql.media))&&!e.mql.matches||!d&&e.mql.matches))if(e.mql.matches=d,e.listeners)for(var d=0,f=e.listeners.length;d<f;d++)e.listeners[d]&&e.listeners[d].call(c,e.mql,a)}while(b--)},10)},setMutableFeatures:function(){var a=c.innerWidth||s.clientWidth,b=c.innerHeight||s.clientHeight;this.features.width=a;this.features.height=b;this.features["aspect-ratio"]=(b/a).toFixed(2);this.features.orientation=
b>=a?"portrait":"landscape"},listen:function(a){c.addEventListener?(c.addEventListener("resize",a),c.addEventListener("orientationchange",a)):c.attachEvent&&(c.attachEvent("onresize",a),c.attachEvent("onorientationchange",a))},init:function(){var a=c.devicePixelRatio;this.supported=1===parseFloat(n.height);this.type="screen print speech projection handheld tv braille embossed tty".split(" ")[parseFloat(n.zIndex)-1]||"all";this.features.resolution=a&&96*a||screen.deviceXDPI||parseFloat(n.width);this.setMutableFeatures();
this.listen(this.watch)}};Media.init()})(window);