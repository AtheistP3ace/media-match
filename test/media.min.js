/* Media - Testing css media queries in Javascript. Authors & copyright (c) 2012: WebLinc, David Knight, Zac Owen. */

(function(c){var l=c.document,p=l.getElementsByTagName("head")[0],d=c.getComputedStyle&&c.getComputedStyle(p,null)||p.currentStyle,q=l.documentElement,t=/\(\s*(not)?\s*(min|max)?-?([^:\s]+)\s*:\s*([^\s]+)\s*\)/,u=/(not)?\s*(\w*)/,n=0,r=0;c.Media={supported:!1,type:"all",queries:[],features:{width:0,height:0,"aspect-ratio":0,color:screen.colorDepth,"color-index":Math.pow(2,screen.colorDepth),"device-aspect-ratio":(screen.height/screen.width).toFixed(2),"device-width":screen.width,"device-height":screen.height,
monochrome:Number(2==screen.colorDepth),orientation:"landscape",resolution:96},getAbsValue:function(a){var b;return(b=a.match(/([\d\.]+)(px|em|rem|%|in|cm|mm|ex|pt|pc)/))?"em"==b[2]?16*b[1]:"pt"==b[2]?this.features.resolution/72*b[1]:1*b[1]:(b=a.match(/(\d+)[\/:](\d+)/))?b[1]/b[2]:(b=a.match(/([\d]+)(dpi|dppx|dpcm)/))?"dpcm"==b[2]?0.3937*b[1]:"dppx"==b[2]?96*b[1]:1*b[1]:a},parseMatch:function(a,b){var e="string"===typeof a?a.split(", "):a,s=e.pop(),c="all",k=s.split(" and "),m=k.length-1;do{var f=
null,g=!0,h=null,h=!0,j=!1;if(-1===k[m].indexOf("(")||(f=k[m].match(t))){if(f)var g=this.features[f[3]],d=this.getAbsValue(f[4]),j="not"===f[1],g="min"===f[2]?g>=d:"max"===f[2]?g<=d:"undefined"!==f[4]?g===d:g;else h=k[m].match(u)||["",""],j="not"===h[1],c=h[2]||c,h=c===this.type||"all"===c,b&&j&&(c="screen, print, speech, projection, handheld, tv, braille, embossed, tty".split(c).join(", ").replace(/(,\s){2}/,""));if(f&&(j&&g||!j&&!g)||!f&&(j&&h||!j&&!h))return e.length?this.parseMatch(e,b):!1}}while(m--);
return b&&{matches:!0,type:c,media:s}||!0},match:function(a){var b=n;a={matches:Media.parseMatch(a,!1),media:a,addListener:function(a){Media.queries[b].listeners||(Media.queries[b].listeners=[]);a&&Media.queries[b].listeners.push(a)},removeListener:function(a){var c=Media.queries[b];if(c)for(var d=0,k=c.listeners.length;d<k;d++)c.listeners[d]===a&&c.listeners.splice(d,1)}};n++;Media.queries.push({mql:a,listeners:null});return a},watch:function(a){clearTimeout(r);r=setTimeout(function(){var b=n;Media.setMutableFeatures();
do{var e=Media.queries[b],d=!1;if("undefined"!==typeof e&&((d=Media.parseMatch(e.mql.media))&&!e.mql.matches||!d&&e.mql.matches))if(e.mql.matches=d,e.listeners)for(var d=0,l=e.listeners.length;d<l;d++)e.listeners[d]&&e.listeners[d].call(c,e.mql,a)}while(b--)},10)},setMutableFeatures:function(){var a=c.innerWidth||q.clientWidth,b=c.innerHeight||q.clientHeight;this.features.width=a;this.features.height=b;this.features["aspect-ratio"]=(b>=a?b/a:a/b).toFixed(2);this.features.orientation=b>=a?"portrait":
"landscape"},listen:function(a){c.addEventListener?(c.addEventListener("resize",a),c.addEventListener("orientationchange",a)):c.attachEvent&&(c.attachEvent("onresize",a),c.attachEvent("onorientationchange",a))},init:function(){var a=c.devicePixelRatio;this.supported=1===parseFloat(d.height);this.type="screen print speech projection handheld tv braille embossed tty".split(" ")[parseFloat(d.zIndex)-1]||"all";this.features.resolution=a&&96*a||screen.deviceXDPI||parseFloat(d.width);this.setMutableFeatures();
this.listen(this.watch)}};Media.init()})(window);